var j=Object.defineProperty;var S=(e,t,o)=>t in e?j(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var c=(e,t,o)=>(S(e,typeof t!="symbol"?t+"":t,o),o);const P=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function o(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerpolicy&&(r.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?r.credentials="include":n.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=o(n);fetch(n.href,r)}};P();const w=document.querySelector("link[rel=manifest]");w&&(w.href=`data:application/manifest+json,${encodeURIComponent(JSON.stringify({name:"Asteroids Game",short_name:"Asteroids",start_url:location.href,background_color:"#000000",theme_color:"#000000",display:"fullscreen",icons:[{type:"image/png",sizes:"any",src:`${location.href}/asteroids-game-logo.svg`}]}))}`);const z=["projectile","enemy-hit2","game-over","buzz"],q=new Map(z.map(e=>{const t=document.createElement("audio");return t.src=`/asteroids-canvas-game-typescript/audio/${e}.mp3`,t.volume=.2,[e,{audio:t}]})),A=()=>{let e=!1;return{start(){e=!0},play(t){if(!e)return;let{audio:o}=q.get(t);o.play()}}};let x;function F(e){function t(){innerWidth>innerHeight?x={factor:innerWidth/50,offsetX:0,offsetY:innerWidth-innerHeight}:x={factor:innerHeight/50,offsetX:innerHeight-innerWidth,offsetY:0},e.width=innerWidth*2,e.height=innerHeight*2,e.style.width=`${innerWidth}px`,e.style.height=`${innerHeight}px`}t();let o;function i(){clearTimeout(o),o=setTimeout(()=>{t()},100)}addEventListener("resize",i),addEventListener("orientationchange",i),addEventListener("touchstart",n,{passive:!1}),addEventListener("touchmove",n,{passive:!1}),addEventListener("contextmenu",n,{passive:!1}),addEventListener("selectstart",n,{passive:!1}),addEventListener("selectionchange",n,{passive:!1});function n(r){r.preventDefault()}}class O{constructor(){c(this,"_x",0);c(this,"_y",0);c(this,"_speed",0)}reset({x:t,y:o}){this._x=t,this._y=o,this._speed=Math.hypot(t,o)}get x(){return this._x}get y(){return this._y}get speed(){return this._speed}set x(t){this._x=t,this._speed=Math.hypot(this._x,this._y)}set y(t){this._y=t,this._speed=Math.hypot(this._x,this._y)}}class h{constructor(){c(this,"position",{x:0,y:0});c(this,"velocity",new O);c(this,"radius",0);c(this,"color","white");c(this,"alpha",0);c(this,"free",!0)}start({position:t,velocity:o={x:0,y:0},radius:i,color:n,alpha:r=1}){return this.position=t,this.velocity.reset(o),this.radius=i,this.color=n,this.alpha=r,this.free=!1,this}update(){this.position.x+=this.velocity.x,this.position.y+=this.velocity.y}draw(t){const{color:o}=this,{position:{x:i,y:n},radius:r}=Y(this);t.save(),t.globalAlpha=this.alpha,t.beginPath(),t.arc(i,n,r,0,Math.PI*2,!1),t.fillStyle=o,t.fill(),t.restore()}get speed(){return Math.hypot(this.velocity.x,this.velocity.y)}}class H extends h{}class W extends h{}class $ extends h{constructor(){super(...arguments);c(this,"color","white")}}class X extends h{update(){super.update(),this.velocity.x*=.9999,this.velocity.y*=.9999,this.alpha-=.01}}function Y(e){const{factor:t,offsetX:o,offsetY:i}=x,n={x:e.position.x*t-o,y:e.position.y*t-i},r=e.radius*t;return{position:n,radius:r}}class y{constructor(t,o,i=[]){c(this,"Klass");c(this,"size",0);c(this,"items",[]);this.Klass=t,this.size=o,this.items=i}getFree(){for(const o of this.items)if(!!o.free)return o.free=!1,o;if(this.items.length===this.size)return null;const t=new this.Klass;return this.items.push(t),t}*[Symbol.iterator](){for(const t of this.items)t.free||(yield t)}}const d=document.querySelector("#app canvas"),v=document.querySelector("#menu"),C=document.querySelector("#score"),u=d.getContext("2d");let g;F(d);k();G();const f=A(),p=new Map;let s;function M(){f.play("buzz"),v.classList.add("hidden"),s={running:!0,score:0,player:new H().start({position:{x:50,y:50},radius:5,color:"green"}),enemies:new y(W,100),projectiles:new y($,100),particles:new y(X,100)},window.game=s,g||(g=requestAnimationFrame(L))}function K(){f.play("game-over"),s.running=!1,v.classList.remove("hidden")}function L(e){N(e),T(),g=requestAnimationFrame(L)}let E=-1e3;function N(e){const t=Math.max(500,1e3-Math.pow(s.score,.6666666666666666));e>E+t&&(E=e,D());for(const i of s.particles)i.update(),(_(i)||i.alpha<=0)&&(i.free=!0);for(const i of s.projectiles)i.update(),_(i)&&(i.free=!0);for(const i of s.enemies)if(!i.free){i.update();for(const n of s.projectiles)Math.hypot(n.position.x-i.position.x,n.position.y-i.position.y)-n.radius>=2||(n.free=!0,f.play("enemy-hit2"),i.radius>3?(s.score+=100,i.radius*=.5):(s.score+=250,i.free=!0),m(i,n));for(const n of s.enemies){if(n===i||n.free||i.free||Math.hypot(n.position.x-i.position.x,n.position.y-i.position.y)-n.radius>=2)continue;f.play("enemy-hit2");let[a,l]=n.radius<i.radius?[n,i]:[i,n];l.speed*3<a.speed?[a,l]=[l,a]:(l.velocity.x*=.95,l.velocity.y*=.95),l.radius=Math.sqrt((Math.pow(l.radius,2)*Math.PI+Math.pow(a.radius,2))/Math.PI),a.radius>3?a.radius*=.5:a.free=!0,m(a,l)}i.position.x>=100&&(i.position.x=0),i.position.x<0&&(i.position.x=100),i.position.y>=100&&(i.position.y=0),i.position.y<0&&(i.position.y=100)}const o=s.player.position;o.x>=100&&(o.x=0),o.x<0&&(o.x=100),o.y>=100&&(o.y=0),o.y<0&&(o.y=100);for(const[,i]of p)b(i);for(const i of navigator.getGamepads())if(!!(i!=null&&i.connected))if(s.running){const[n,r,a,l]=i.axes;if((Math.abs(n)>.4||Math.abs(r)>.4)&&(s.player.position.x+=n/10,s.player.position.y+=r/10),Math.abs(a)>.4||Math.abs(l)>.4){const I=Math.atan2(l,a);b(I)}}else{const n=i.buttons.flatMap((a,l)=>a.pressed?[l]:[]);[0,1,2,3].some(a=>n.includes(a))&&M()}if(!!s.running)for(const i of s.enemies)Math.hypot(s.player.position.x-i.position.x,s.player.position.y-i.position.y)-i.radius<2&&(m(s.player,i),K())}function T(){u.fillStyle="rgba(0,0,0,0.05)",u.fillRect(0,0,d.width,d.height);for(const e of s.particles)e.draw(u);for(const e of s.projectiles)e.draw(u);for(const e of s.enemies)e.draw(u);s.running&&s.player.draw(u),C.textContent=`${s.score}`}function b(e){var t;(t=s.projectiles.getFree())==null||t.start({position:{...s.player.position},velocity:{x:Math.cos(e),y:Math.sin(e)},color:"white",radius:1}),f.play("projectile")}function k(){d.addEventListener("pointerdown",e=>{f.start();const t={x:e.clientX-innerWidth/2,y:e.clientY-innerHeight/2},o=Math.atan2(t.y,t.x);p.set(e.pointerId,o)}),d.addEventListener("pointermove",e=>{if(!p.has(e.pointerId))return;const t={x:e.clientX-innerWidth/2,y:e.clientY-innerHeight/2},o=Math.atan2(t.y,t.x);p.set(e.pointerId,o)}),d.addEventListener("pointerup",e=>{p.delete(e.pointerId)}),d.addEventListener("pointerleave",e=>{p.delete(e.pointerId)}),d.addEventListener("pointercancel",e=>{p.delete(e.pointerId)})}function D(){var n;const e=Math.random()<.5?{x:Math.random()<.5?0:100,y:Math.random()*100}:{x:Math.random()*100,y:Math.random()<.5?0:100},t={x:s.player.position.x-e.x,y:s.player.position.y-e.y},o=Math.atan2(t.y,t.x),i=Math.random()*.75+.5;(n=s.enemies.getFree())==null||n.start({position:e,velocity:{x:Math.cos(o)/10*i,y:Math.sin(o)/10*i},radius:Math.random()*4+1,color:`hsl(${Math.random()*360}, 50%,50%)`})}function _(e){const{x:t,y:o}=e.position;return t<0||o<0||t>100||o>100}function G(){var e;(e=v.querySelector("button"))==null||e.addEventListener("pointerdown",()=>{M(),f.start()})}function m(e,t){var o;for(let i=0;i<e.radius**2+4;i++){const n={x:(Math.random()-.5)*2,y:(Math.random()-.5)*2};(o=s.particles.getFree())==null||o.start({position:{...t.position},radius:.5,color:e.color,velocity:n,alpha:.5})}}M();
